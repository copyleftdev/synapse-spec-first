// Code generated by synctl. DO NOT EDIT.
package generated

import (
	"context"
	"encoding/json"
	"fmt"

	"github.com/ThreeDotsLabs/watermill"
	"github.com/ThreeDotsLabs/watermill/message"
)

// Ensure imports are used
var _ = watermill.NewUUID

// Event topics
const (
	TopicOrdersDlq             = "orders.dlq"
	TopicOrdersEnriched        = "orders.enriched"
	TopicOrdersIngest          = "orders.ingest"
	TopicOrdersRouted          = "orders.routed.{destination}"
	TopicOrdersValidated       = "orders.validated"
	TopicPipelineErrors        = "pipeline.errors"
	TopicPipelineStageComplete = "pipeline.stage.{stageId}.complete"
)

// EventPublisher publishes events to NATS via Watermill
type EventPublisher struct {
	publisher message.Publisher
}

// NewEventPublisher creates a new event publisher
func NewEventPublisher(pub message.Publisher) *EventPublisher {
	return &EventPublisher{publisher: pub}
}

// PublishOrderEnriched publishes a OrderEnriched event
func (p *EventPublisher) PublishOrderEnriched(ctx context.Context, topic string, payload any) error {
	data, err := json.Marshal(payload)
	if err != nil {
		return fmt.Errorf("marshaling OrderEnriched: %w", err)
	}

	msg := message.NewMessage(watermill.NewUUID(), data)
	return p.publisher.Publish(topic, msg)
}

// PublishOrderFailed publishes a OrderFailed event
func (p *EventPublisher) PublishOrderFailed(ctx context.Context, topic string, payload any) error {
	data, err := json.Marshal(payload)
	if err != nil {
		return fmt.Errorf("marshaling OrderFailed: %w", err)
	}

	msg := message.NewMessage(watermill.NewUUID(), data)
	return p.publisher.Publish(topic, msg)
}

// PublishOrderReceived publishes a OrderReceived event
func (p *EventPublisher) PublishOrderReceived(ctx context.Context, topic string, payload any) error {
	data, err := json.Marshal(payload)
	if err != nil {
		return fmt.Errorf("marshaling OrderReceived: %w", err)
	}

	msg := message.NewMessage(watermill.NewUUID(), data)
	return p.publisher.Publish(topic, msg)
}

// PublishOrderRouted publishes a OrderRouted event
func (p *EventPublisher) PublishOrderRouted(ctx context.Context, topic string, payload any) error {
	data, err := json.Marshal(payload)
	if err != nil {
		return fmt.Errorf("marshaling OrderRouted: %w", err)
	}

	msg := message.NewMessage(watermill.NewUUID(), data)
	return p.publisher.Publish(topic, msg)
}

// PublishOrderValidated publishes a OrderValidated event
func (p *EventPublisher) PublishOrderValidated(ctx context.Context, topic string, payload any) error {
	data, err := json.Marshal(payload)
	if err != nil {
		return fmt.Errorf("marshaling OrderValidated: %w", err)
	}

	msg := message.NewMessage(watermill.NewUUID(), data)
	return p.publisher.Publish(topic, msg)
}

// PublishPipelineError publishes a PipelineError event
func (p *EventPublisher) PublishPipelineError(ctx context.Context, topic string, payload any) error {
	data, err := json.Marshal(payload)
	if err != nil {
		return fmt.Errorf("marshaling PipelineError: %w", err)
	}

	msg := message.NewMessage(watermill.NewUUID(), data)
	return p.publisher.Publish(topic, msg)
}

// PublishStageComplete publishes a StageComplete event
func (p *EventPublisher) PublishStageComplete(ctx context.Context, topic string, payload any) error {
	data, err := json.Marshal(payload)
	if err != nil {
		return fmt.Errorf("marshaling StageComplete: %w", err)
	}

	msg := message.NewMessage(watermill.NewUUID(), data)
	return p.publisher.Publish(topic, msg)
}

// EventHandler handles incoming events
type EventHandler interface {
	HandleOrdersDlq(ctx context.Context, msg *message.Message) error
	HandleOrdersEnriched(ctx context.Context, msg *message.Message) error
	HandleOrdersIngest(ctx context.Context, msg *message.Message) error
	HandleOrdersRouted(ctx context.Context, msg *message.Message) error
	HandleOrdersValidated(ctx context.Context, msg *message.Message) error
	HandlePipelineErrors(ctx context.Context, msg *message.Message) error
	HandlePipelineStageComplete(ctx context.Context, msg *message.Message) error
}

// EventRouter sets up Watermill message routing
type EventRouter struct {
	handler EventHandler
}

// NewEventRouter creates a new event router
func NewEventRouter(handler EventHandler) *EventRouter {
	return &EventRouter{handler: handler}
}

// RegisterHandlers registers all event handlers with a Watermill router
func (er *EventRouter) RegisterHandlers(router *message.Router, subscriber message.Subscriber) {
	router.AddNoPublisherHandler(
		"handle_orders/dlq",
		TopicOrdersDlq,
		subscriber,
		er.handleOrdersDlq,
	)
	router.AddNoPublisherHandler(
		"handle_orders/enriched",
		TopicOrdersEnriched,
		subscriber,
		er.handleOrdersEnriched,
	)
	router.AddNoPublisherHandler(
		"handle_orders/ingest",
		TopicOrdersIngest,
		subscriber,
		er.handleOrdersIngest,
	)
	router.AddNoPublisherHandler(
		"handle_orders/routed",
		TopicOrdersRouted,
		subscriber,
		er.handleOrdersRouted,
	)
	router.AddNoPublisherHandler(
		"handle_orders/validated",
		TopicOrdersValidated,
		subscriber,
		er.handleOrdersValidated,
	)
	router.AddNoPublisherHandler(
		"handle_pipeline/errors",
		TopicPipelineErrors,
		subscriber,
		er.handlePipelineErrors,
	)
	router.AddNoPublisherHandler(
		"handle_pipeline/stage-complete",
		TopicPipelineStageComplete,
		subscriber,
		er.handlePipelineStageComplete,
	)
}

func (er *EventRouter) handleOrdersDlq(msg *message.Message) error {
	return er.handler.HandleOrdersDlq(context.Background(), msg)
}

func (er *EventRouter) handleOrdersEnriched(msg *message.Message) error {
	return er.handler.HandleOrdersEnriched(context.Background(), msg)
}

func (er *EventRouter) handleOrdersIngest(msg *message.Message) error {
	return er.handler.HandleOrdersIngest(context.Background(), msg)
}

func (er *EventRouter) handleOrdersRouted(msg *message.Message) error {
	return er.handler.HandleOrdersRouted(context.Background(), msg)
}

func (er *EventRouter) handleOrdersValidated(msg *message.Message) error {
	return er.handler.HandleOrdersValidated(context.Background(), msg)
}

func (er *EventRouter) handlePipelineErrors(msg *message.Message) error {
	return er.handler.HandlePipelineErrors(context.Background(), msg)
}

func (er *EventRouter) handlePipelineStageComplete(msg *message.Message) error {
	return er.handler.HandlePipelineStageComplete(context.Background(), msg)
}

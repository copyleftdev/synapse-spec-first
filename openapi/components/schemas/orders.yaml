# Order Schemas

OrderCreateRequest:
  type: object
  required:
    - customerId
    - items
    - totalAmount
    - currency
  properties:
    orderId:
      type: string
      format: uuid
      description: |
        Client-provided order ID. If omitted, server generates one.
        Useful for idempotency when combined with Idempotency-Key header.
    customerId:
      type: string
      format: uuid
      description: Customer placing the order
    items:
      type: array
      minItems: 1
      maxItems: 100
      items:
        $ref: '#/OrderItem'
    totalAmount:
      type: number
      format: double
      minimum: 0.01
      description: Total order amount (must match sum of item prices)
    currency:
      type: string
      pattern: '^[A-Z]{3}$'
      description: ISO 4217 currency code
      examples:
        - USD
        - EUR
        - GBP
    shippingAddress:
      $ref: '#/Address'
    billingAddress:
      $ref: '#/Address'
    metadata:
      type: object
      additionalProperties: true
      maxProperties: 20
      description: Custom metadata (max 20 keys, values must be strings)

OrderItem:
  type: object
  required:
    - sku
    - quantity
    - unitPrice
  properties:
    sku:
      type: string
      minLength: 1
      maxLength: 50
      description: Stock keeping unit
    productName:
      type: string
      maxLength: 200
    quantity:
      type: integer
      minimum: 1
      maximum: 10000
    unitPrice:
      type: number
      format: double
      minimum: 0

Address:
  type: object
  required:
    - street
    - city
    - country
  properties:
    street:
      type: string
      maxLength: 200
    street2:
      type: string
      maxLength: 200
    city:
      type: string
      maxLength: 100
    state:
      type: string
      maxLength: 100
    postalCode:
      type: string
      maxLength: 20
    country:
      type: string
      pattern: '^[A-Z]{2}$'
      description: ISO 3166-1 alpha-2 country code

OrderAcceptedResponse:
  type: object
  required:
    - orderId
    - status
    - message
    - links
  properties:
    orderId:
      type: string
      format: uuid
    status:
      type: string
      enum:
        - accepted
    message:
      type: string
    links:
      $ref: '#/OrderLinks'

OrderLinks:
  type: object
  required:
    - self
  properties:
    self:
      type: string
      format: uri-reference
    events:
      type: string
      format: uri-reference
    cancel:
      type: string
      format: uri-reference

OrderResponse:
  type: object
  required:
    - orderId
    - customerId
    - status
    - items
    - totalAmount
    - currency
    - createdAt
    - updatedAt
  properties:
    orderId:
      type: string
      format: uuid
    customerId:
      type: string
      format: uuid
    status:
      $ref: '#/OrderStatus'
    currentStage:
      type: string
      description: Current pipeline stage (if processing)
    items:
      type: array
      items:
        $ref: '#/OrderItem'
    totalAmount:
      type: number
      format: double
    currency:
      type: string
    shippingAddress:
      $ref: '#/Address'
    enrichment:
      $ref: '#/OrderEnrichment'
    routing:
      $ref: '#/OrderRouting'
    createdAt:
      type: string
      format: date-time
    updatedAt:
      type: string
      format: date-time
    links:
      $ref: '#/OrderLinks'

OrderStatus:
  type: string
  enum:
    - accepted
    - validating
    - validated
    - enriching
    - enriched
    - routing
    - routed
    - failed
    - cancelled
  description: |
    Order lifecycle status:
    - `accepted`: Order received, queued for processing
    - `validating`: Schema/business validation in progress
    - `validated`: Validation passed
    - `enriching`: Customer/fraud enrichment in progress
    - `enriched`: Enrichment complete
    - `routing`: Route decision in progress
    - `routed`: Final destination determined
    - `failed`: Processing failed (see events for details)
    - `cancelled`: Order cancelled by user

OrderEnrichment:
  type: object
  description: Data added during enrichment stage
  properties:
    customer:
      type: object
      properties:
        tier:
          type: string
          enum: [bronze, silver, gold, platinum]
        accountAgeDays:
          type: integer
        lifetimeValue:
          type: number
        orderCount:
          type: integer
    inventory:
      type: object
      properties:
        allAvailable:
          type: boolean
        unavailableSkus:
          type: array
          items:
            type: string
    fraud:
      type: object
      properties:
        score:
          type: number
          minimum: 0
          maximum: 100
        riskLevel:
          type: string
          enum: [low, medium, high, critical]
        signals:
          type: array
          items:
            type: string

OrderRouting:
  type: object
  description: Routing decision details
  properties:
    destination:
      type: string
      enum: [fulfillment, manual-review, rejected]
    reason:
      type: string
    priority:
      type: string
      enum: [low, normal, high, urgent]
    routedAt:
      type: string
      format: date-time

OrderListResponse:
  type: object
  required:
    - orders
    - pagination
  properties:
    orders:
      type: array
      items:
        $ref: '#/OrderSummary'
    pagination:
      $ref: '#/Pagination'

OrderSummary:
  type: object
  required:
    - orderId
    - customerId
    - status
    - totalAmount
    - currency
    - createdAt
  properties:
    orderId:
      type: string
      format: uuid
    customerId:
      type: string
      format: uuid
    status:
      $ref: '#/OrderStatus'
    totalAmount:
      type: number
    currency:
      type: string
    itemCount:
      type: integer
    createdAt:
      type: string
      format: date-time
    links:
      $ref: '#/OrderLinks'

Pagination:
  type: object
  required:
    - limit
    - hasMore
  properties:
    limit:
      type: integer
    cursor:
      type: string
      description: Current cursor position
    nextCursor:
      type: string
      description: Cursor for next page (null if no more)
    hasMore:
      type: boolean

OrderCancelledResponse:
  type: object
  required:
    - orderId
    - status
    - cancelledAt
  properties:
    orderId:
      type: string
      format: uuid
    status:
      type: string
      enum: [cancelled]
    previousStatus:
      type: string
    cancelledAt:
      type: string
      format: date-time
    message:
      type: string

OrderEventsResponse:
  type: object
  required:
    - orderId
    - events
  properties:
    orderId:
      type: string
      format: uuid
    events:
      type: array
      items:
        $ref: '#/OrderEvent'

OrderEvent:
  type: object
  required:
    - eventId
    - stage
    - status
    - timestamp
  properties:
    eventId:
      type: string
    stage:
      type: string
    status:
      type: string
      enum: [started, completed, failed, skipped]
    timestamp:
      type: string
      format: date-time
    durationMs:
      type: integer
    metadata:
      type: object
      additionalProperties: true
    error:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
